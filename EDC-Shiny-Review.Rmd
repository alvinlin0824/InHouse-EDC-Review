---
title: "InHouse 16157 `r params$Study` EDC Review"
author: "Alvin, Lin" 
date: "`r Sys.Date()`"
output: 
    distill::distill_article:
      toc: true
      toc_float: true

params:
    Study: IH089
    label: FALSE
    data1:
      label: "Upload ae1 :"
      value: FALSE
      input: file
    data2:
      label: "Upload ae2 :"
      value: FALSE
      input: file
    data3:
      label: "Upload cm2 :"
      value: FALSE
      input: file
    data4:
      label: "Upload de :"
      value: FALSE
      input: file
    data5:
      label: "Upload dm :"
      value: FALSE
      input: file
    data6:
      label: "Upload du1 :"
      value: FALSE
      input: file
    data7:
      label: "Upload du2 :"
      value: FALSE
      input: file
    data8:
      label: "Upload du3 :"
      value: FALSE
      input: file
    data9:
      label: "Upload pd :"
      value: FALSE
      input: file
    data10:
      label: "Upload vs :"
      value: FALSE
      input: file
    data11:
      label: "Upload du4 :"
      value: FALSE
      input: file
    data12:
      label: "Upload du5 :"
      value: FALSE
      input: file
    data13:
      label: "Upload ie :"
      value: FALSE
      input: file
    data14:
      label: "Upload mh :"
      value: FALSE
      input: file
    data15:
      label: "Upload dt2 :"
      value: FALSE
      input: file
    data16:
      label: "Upload dt3 :"
      value: FALSE
      input: file
    data17:
      label: "Upload dt4 :"
      value: FALSE
      input: file
    data18:
      label: "Upload dl2 :"
      value: FALSE
      input: file
    data19:
      label: "Upload ml2 :"
      value: FALSE
      input: file
    data20:
      label: "Upload sk1 :"
      value: FALSE
      input: file
    data21:
      label: "Upload sk2 :"
      value: FALSE
      input: file
      
---
<!-- delete all the variables that are there in the environment  rm(list=ls())  -->
```{r include=F}
options(shiny.maxRequestSize = 30*1024^2)
```

<!-- EDC \\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current -->

 <!-- CRF \\oneabbott.com\dept\ADC\Technical_OPS\Clinical_Affairs\Clinical Study Files\Sensor Systems\ADC-US-RES-16157_InHouse Sensor\CDM\Database\CRF Load Files\aCRFS -->

```{r Setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      tidy = TRUE,
                      tidy.opts = list(width.cutoff=50),
                      layout = "l-screen")
```

```{r Libaray Packages, message=FALSE, include=F}
library(tidyverse)
library(lubridate)
library(haven)
library(htmltools)
library(reactable)
```

```{r include=F}
colorize <- function(x, color) {
  if (knitr::is_latex_output()) {
    sprintf("\\textcolor{%s}{%s}", color, x)
  } else if (knitr::is_html_output()) {
    sprintf("<span style='color: %s;'>%s</span>", color,
      x)
  } else x
}
```

[Statistics Data Queries](https://abbott.sharepoint.com/teams/adc-rnd/Clinical_Affairs/Shared%20Documents/Forms/AllItems.aspx?originalPath=aHR0cHM6Ly9hYmJvdHQuc2hhcmVwb2ludC5jb20vOmY6L3QvYWRjLXJuZC9DbGluaWNhbF9BZmZhaXJzL0VxQVVMSVZNWmoxRWdFUHppbFYyXy1zQjlwcnpnWk5mY0xTbE9UcWVIT3JfNVE%5FcnRpbWU9dHNNSHg3RjUxMGc&id=%2Fteams%2Fadc%2Drnd%2FClinical%5FAffairs%2FShared%20Documents%2F09%20Data%20Management%2FStatistics%20Data%20Queries&viewid=314c97dd%2D7a24%2D48d8%2Dbb69%2D24b617321996)


<!-- # AE1 Review -->

`r if(is.character(params$data1)){knitr::asis_output("# **AE1 Review**")}`
`r if(is.character(params$data1)){htmltools::a("Adverse Event Report",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_AE_RevA.pdf")}`

```{r Load ae1, eval = is.character(params$data1)}
# ae1 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\119\ae1.sas7bdat)"))
ae1 <- read_sas(params$data1)
ae1 <- ae1 %>%
       filter(!str_detect(AEYN01,regex("CHECK HERE IF NO DATA RECORDED|no_data_recorded",ignore_case = T))) %>%
       # mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r ae1, eval=is.character(params$data1)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('ae1', 'ae1.csv')"
    ),
ae1[
# Is this a serious adverse event?
!str_detect(ae1$AESER01,regex("Yes|No",ignore_case = T)) |
# AE Number
is.na(ae1$AENUM01) |
# Site awareness date
(is.na(ae1$AEDTC01) | str_detect(ae1$AEDTC01,"^$|pattern")) |
# Length of Site awareness date
str_length(ae1$AEDTC01) != median(str_length(ae1$AEDTC01),na.rm = T) | is.na(ae1$AEDTC01) |
# Is this adverse event an application site adverse event?
!str_detect(ae1$AEORES01,regex("Yes|No",ignore_case = T)) |
# If AEORES01 is No Description of Event
str_detect(ae1$AEORES01,regex("No",ignore_case = T))  & (str_detect(ae1$AETERM01,"^$|pattern") | !str_detect(ae1$AEHYPO01,regex("Yes|No",ignore_case = T)) | str_detect(ae1$AECOM01,"^$|pattern")) |
# If AEORES01 is Yes Description of Event Symptom and Other (Symptom)
str_detect(ae1$AEORES01,regex("Yes",ignore_case = T)) & !str_detect(str_to_lower(ae1$AEDESC01),"erythema|induration|pain|edema|bruising|itching|rash|bleeding|infection|other")  |
# If Other (Symptom)
str_detect(str_to_lower(ae1$AEDESC01),"other") & !str_detect(str_to_lower(ae1$AEDSCO02),"bump|abrasion|laceration|scar|soreness|induration with serosanguinous fluid|roughness") |
# Affected area and NA for erythema|induration|edema|bruising|rash|infection
str_detect(str_to_lower(ae1$AEDESC01),"erythema|induration|edema|bruising|rash|infection") & (str_detect(ae1$AENUM02,"^$|pattern") & str_detect(ae1$AEORES02,"^$|pattern"))    | 
str_detect(str_to_lower(ae1$AEDESC01),"erythema|induration|edema|bruising|rash|infection") & (!is.na(ae1$AENUM02) & !str_detect(ae1$AEORES02,"^$|pattern"))  |
# Affected area and NA for Affected area for pain|itching|bleeding
str_detect(str_to_lower(ae1$AEDESC01),"pain|itching|bleeding") & (!str_detect(ae1$AENUM02,"^$|pattern") | !str_detect(ae1$AEORES02,"NA"))  |
# Intensity of erythema and edema
str_detect(str_to_lower(ae1$AEDESC01),"erythema|edema") &
(str_detect(ae1$AENUM03,"^$|pattern") & str_detect(ae1$AEORES03,"^$|pattern"))  |
str_detect(str_to_lower(ae1$AEDESC01),"erythema|edema") &
(!str_detect(ae1$AENUM03,"^$|pattern") & !str_detect(ae1$AEORES03,"^$|pattern")) |
# Onset date
(is.na(ae1$AESTDT01) | str_detect(ae1$AESTDT01,"^$|pattern"))   |
# Length of Onset Date
str_length(ae1$AESTDT01) != median(str_length(ae1$AESTDT01),na.rm = T) | is.na(ae1$AESTDT01) |
# onset date and time
str_detect(ae1$AESTTM02,"^$|pattern") & str_detect(ae1$AESTTM01,"^$|pattern") |
# Severity
!str_detect(str_to_lower(ae1$AESEV01),"mild|moderate|severe") |
# Is this adverse event related to a Study Device?
str_detect(ae1$AEREL01,"Not Related") & str_detect(str_to_lower(ae1$AEEVNT01),"anticipated|unanticipated") |
str_detect(ae1$AEREL01,"Related|Possibly Related") & (str_detect(ae1$AEEVNT01,"^$|pattern") | is.na(ae1$AENUM04)) |
# Is this adverse event related to a Study Procedure?
str_detect(ae1$AEREL02,"Not Related") &
str_detect(str_to_lower(ae1$AEEVNT02),"anticipated|unanticipated") |
str_detect(ae1$AEREL02,"Related|Possibly Related") & str_detect(ae1$AEEVNT02,"^$|pattern") |
#  Was action required for the adverse event?
!str_detect(ae1$AEORES05,regex("Yes|No",ignore_case = T))|
# If yes,
str_detect(ae1$AEORES05,regex("Yes",ignore_case = T)) & str_detect(ae1$AECOM06,"^$|pattern")|
#  Was treatment required for the adverse event?
!str_detect(ae1$AEORES06,regex("Yes|No",ignore_case = T)) |
# If yes,
str_detect(ae1$AEORES06,regex("Yes",ignore_case = T)) & str_detect(ae1$AECOM07,"^$|pattern") |
# Outcome
!str_detect(ae1$AEDUR01,regex("Ongoing|Resolved or resolved with sequelae|Death",ignore_case = T))|
# If outcome is ongoing, outcome date and time should be blank
str_detect(ae1$AEDUR01,regex("Ongoing",ignore_case = T)) & (!is.na(ae1$AEENDT01) | !str_detect(ae1$AEENTM01,"^$|pattern") | !str_detect(ae1$AEENTM02,"^$|pattern")) | 
# If outcome is Resolved or resolved with sequelae or Death
# Outcome Date
(str_detect(ae1$AEDUR01,regex("Resolved or resolved with sequelae|Death",ignore_case = T)) & (is.na(ae1$AEENDT01) | str_detect(ae1$AEENDT01,"^$|pattern")))      |
# Length of Outcome Date
(str_detect(ae1$AEDUR01,regex("Resolved or resolved with sequelae|Death",ignore_case = T)) & str_length(ae1$AEENDT01) != median(str_length(ae1$AEENDT01),na.rm = T)) | is.na(ae1$AEENDT01) |
# Outcome time
(str_detect(ae1$AEDUR01,regex("Resolved or resolved with sequelae|Death",ignore_case = T)) & (str_detect(ae1$AEENTM01,"^$|pattern") & !str_detect(ae1$AEENTM02,regex("End Time Unknown",ignore_case = T)))) |
# Investigator Acknowledgement Date
(is.na(ae1$AEDTC03) | str_detect(ae1$AEDTC03,"^$|pattern"))    |
# Length of Investigator Acknowledgement Date
str_length(ae1$AEDTC03) != median(str_length(ae1$AEDTC03),na.rm = T) | is.na(ae1$AEDTC03),][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "ae1",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data1) && is_empty(ae1$Subject)){knitr::asis_output(colorize("AE1 is empty","red"))}`

`r if(is.character(params$data1)){knitr::asis_output("1. AESER01 (Is this a serious adverse event?) should be either Yes or No")}` `r if(is.character(params$data1)){colorize(ae1[!str_detect(ae1$AESER01,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("2. AENUM01(AE Number) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[is.na(ae1$AENUM01),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("3. AEDTC01 (Site awareness date) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[(is.na(ae1$AEDTC01) | str_detect(ae1$AEDTC01,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("4. Length of AEDTC01 (Site awareness date) should be")}` 
`r if(is.character(params$data1)){median(str_length(ae1$AEDTC01),na.rm = T)}` `r if(is.character(params$data1)){colorize(ae1[(str_length(ae1$AEDTC01) != median(str_length(ae1$AEDTC01),na.rm = T)) | is.na(ae1$AEDTC01),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("5. AEORES01(Is this adverse event an application site adverse event?) should be either Yes or No")}` `r if(is.character(params$data1)){colorize(ae1[!str_detect(ae1$AEORES01,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("6. If AEORES01(Is this adverse event an application site adverse event?) is No, so AETERM01(Adverse Event Term),AEHYPO01(Is this a severe hypoglycemic event?),and  AECOM01(Description of Event) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEORES01,regex("No",ignore_case = T))  & (str_detect(ae1$AETERM01,"^$|pattern") | !str_detect(ae1$AEHYPO01,regex("Yes|No",ignore_case = T)) | str_detect(ae1$AECOM01,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("7. If AEORES01(Is this adverse event an application site adverse event?) is Yes, so AEDESC01(Symptom) should not be blank and the symptom should be erythema,induration,pain,edema,bruising,itching,rash,bleeding,infection,other")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEORES01,regex("Yes",ignore_case = T)) & !str_detect(str_to_lower(ae1$AEDESC01),"erythema|induration|pain|edema|bruising|itching|rash|bleeding|infection|other"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("8. If AEDESC01(Symptom) is other, AEDSCO02(Other (Symptom))shoud be bump,abrasion,laceration,scar,soreness,induration with serosanguinous fluid, roughness")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(str_to_lower(ae1$AEDESC01),"other") & !str_detect(str_to_lower(ae1$AEDSCO02),"bump|abrasion|laceration|scar|soreness|induration with serosanguinous fluid|roughness"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("9. If AEDESC01(Symptom) is erythema,induration,edema,bruising,rash,infection, so  AENUM02(Affected area) and AEORES02(NA for Affected area) should not be blank at the same time")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(str_to_lower(ae1$AEDESC01),"erythema|induration|edema|bruising|rash|infection") & (str_detect(ae1$AENUM02,"^$|pattern") & str_detect(ae1$AEORES02,"^$|pattern")),]$Subject,"red")}` `r if(is.character(params$data1)){knitr::asis_output("and should not have contents at the same time")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(str_to_lower(ae1$AEDESC01),"erythema|induration|edema|bruising|rash|infection") & (!is.na(ae1$AENUM02) & !str_detect(ae1$AEORES02,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("10. If AEDESC01(Symptom) is pain, itching, and bleeding, so AENUM02(Affected area) should be blank and AEORES02(NA for Affected area) should be NA")}`
`r if(is.character(params$data1)){colorize(ae1[str_detect(str_to_lower(ae1$AEDESC01),"pain|itching|bleeding") & (!str_detect(ae1$AENUM02,"^$|pattern") | !str_detect(ae1$AEORES02,"NA")),]$Subject,"red")}` 

`r if(is.character(params$data1)){knitr::asis_output("11. If AEDESC01(Symptom) is erythema,or edema, so AENUM03(Intensity of Erythema) and AEORES03(NA for Intensity) should not be blank at the same time")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(str_to_lower(ae1$AEDESC01),"erythema|edema") & (str_detect(ae1$AENUM03,"^$|pattern") & str_detect(ae1$AEORES03,"^$|pattern")),]$Subject,"red")}` `r if(is.character(params$data1)){knitr::asis_output("and should not have contents at the same time")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(str_to_lower(ae1$AEDESC01),"erythema|edema") & (!str_detect(ae1$AENUM03,"^$|pattern") & !str_detect(ae1$AEORES03,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("12. AESTDT01(Onset date) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[(is.na(ae1$AESTDT01) | str_detect(ae1$AESTDT01,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("13. Length of AESTDT01 (Onset date) should be")}` `r if(is.character(params$data1)){median(str_length(ae1$AESTDT01),na.rm = T)}` `r if(is.character(params$data1)){colorize(ae1[(str_length(ae1$AESTDT01) != median(str_length(ae1$AESTDT01),na.rm = T)) | is.na(ae1$AESTDT01),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("14. AESTTM01(Onset Time) and AESTTM02(Onset Time Unknown) should not be blank at the same time")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AESTTM02,"^$|pattern") & str_detect(ae1$AESTTM01,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("15. AESEV01(Severity) should be either mild, moderate or severe")}` `r if(is.character(params$data1)){colorize(ae1[!str_detect(str_to_lower(ae1$AESEV01),"mild|moderate|severe"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("16. AEREL01 (Is this adverse event related to a Study Device?) is not related, so AEEVNT01(Was the adverse event an unanticipated or anticipated event?) and AENUM04(Sensor Number) should be blank at the same time")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEREL01,"Not Related") & str_detect(str_to_lower(ae1$AEEVNT01),"anticipated|unanticipated"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("17. AEREL01 (Is this adverse event related to a Study Device?) is possibly related or related, so AEEVNT01(Was the adverse event an unanticipated or anticipated event?) and AENUM04(Sensor Number) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEREL01,"Related|Possibly Related") & (str_detect(ae1$AEEVNT01,"^$|pattern") | is.na(ae1$AENUM04)),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("18. AEREL02(Is this adverse event related to a Study Procedure?) is not related, so AEEVNT02(Was the adverse event an unanticipated or anticipated event?) should be blank")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(str_to_lower(ae1$AEREL02),"not related") & str_detect(ae1$AEEVNT02,"anticipated|unanticipated"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("19. AEREL02(Is this adverse event related to a Study Procedure?) is possibly related or related, so AEEVNT02(Was the adverse event an unanticipated or anticipated event?) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEREL02,"Related|Possibly Related") & str_detect(ae1$AEEVNT02,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("20. AEORES05(Was action required for the adverse event?) should be Yes or No")}` `r if(is.character(params$data1)){colorize(ae1[!str_detect(ae1$AEORES05,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("21. If AEORES05(Was action required for the adverse event?) is Yes, AECOM06(provide details) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEORES05,regex("Yes",ignore_case = T)) & str_detect(ae1$AECOM06,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("22. AEORES06(Was treatment required for the adverse event?) should be Yes or No")}` `r if(is.character(params$data1)){colorize(ae1[!str_detect(ae1$AEORES06,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("23. If AEORES06(Was treatment required for the adverse event?) is Yes, AECOM07(Treatment (details)) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEORES06,regex("Yes",ignore_case = T)) & str_detect(ae1$AECOM07,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("24. AEDUR01(Outcome) should be Ongoing, Resolved or resolved with sequelae, Death")}` `r if(is.character(params$data1)){colorize(ae1[!str_detect(ae1$AEDUR01,regex("Ongoing|Resolved or resolved with sequelae|Death",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("25. If AEDUR01(Outcome) is Ongoing, AEENDT01(Outcome date), AEENTM01(Outcome End Time) and AEENTM02(Outcome End Time Unknown) should be blank at the same time")}` `r if(is.character(params$data1)){colorize(ae1[str_detect(ae1$AEDUR01,regex("Ongoing",ignore_case = T)) & (!is.na(ae1$AEENDT01) | !str_detect(ae1$AEENTM01,"^$|pattern") | !str_detect(ae1$AEENTM02,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("26. If AEDUR01(Outcome) is Resolved or resolved with sequelae or Death, AEENDT01(Outcome date) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[(str_detect(ae1$AEDUR01,regex("Resolved or resolved with sequelae|Death",ignore_case = T)) & (is.na(ae1$AEENDT01) | str_detect(ae1$AEENDT01,"^$|pattern"))),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("27. If AEDUR01(Outcome) is Resolved or resolved with sequelae or Death, Length of AEENDT01(Outcome date) should be")}` `r if(is.character(params$data1)){median(str_length(ae1$AEENDT01),na.rm = T)}` `r if(is.character(params$data1)){colorize(ae1[(str_detect(ae1$AEDUR01,regex("Resolved or resolved with sequelae|Death",ignore_case = T)) & str_length(ae1$AEENDT01) != median(str_length(ae1$AEENDT01),na.rm = T)) | is.na(ae1$AEENDT01),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("28. If AEDUR01(Outcome) is Resolved or resolved with sequelae or Death, AEENTM01(Outcome End Time) and AEENTM02(Outcome End Time Unknown) should be eithr blank or unknown")}` `r if(is.character(params$data1)){colorize(ae1[(str_detect(ae1$AEDUR01,regex("Resolved or resolved with sequelae|Death",ignore_case = T)) & (str_detect(ae1$AEENTM01,"^$|pattern") & !str_detect(ae1$AEENTM02,regex("End Time Unknown",ignore_case = T)))),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("29. AEDTC03(Investigator Acknowledgement) should not be blank")}` `r if(is.character(params$data1)){colorize(ae1[(is.na(ae1$AEDTC03) | str_detect(ae1$AEDTC03,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data1)){knitr::asis_output("30. Length of AEDTC03(Investigator Acknowledgement) should be")}` `r if(is.character(params$data1)){median(str_length(ae1$AEDTC03),na.rm = T)}` `r if(is.character(params$data1)){colorize(ae1[(str_length(ae1$AEDTC03) != median(str_length(ae1$AEDTC03),na.rm = T)) | is.na(ae1$AEDTC03),]$Subject,"red")}`

<!-- # AE2 Review -->

`r if(is.character(params$data2)){knitr::asis_output("# **AE2 Review**")}`

`r if(is.character(params$data2)){htmltools::a("Adverse Event Report",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_AE_RevA.pdf")}`

<!-- [Adverse Event Report](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_AE_RevA.pdf) -->

```{r Load ae2, eval = is.character(params$data2)}
# ae2 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\102\ae2.sas7bdat)"))
ae2 <- read_sas(params$data2)
ae2 <- ae2 %>%
       filter(!is.na(AEDTC02)) %>% 
#      mutate(Subject = as.character(Subject),
#             AEDTC02 = as.character(AEDTC02),
#             AEDTC02 = replace_na(AEDTC02,"NA")) %>%
       arrange(Subject)
```

```{r ae2, eval = is.character(params$data2)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('ae2', 'ae2.csv')"
    ),
ae2[
    # Update date
    (str_detect(ae2$AEDTC02,"^$|pattern|NA"))  |
    # Length of update date
    str_length(ae2$AEDTC02) != 10 |
    # Details
    str_detect(ae2$AEORES07,"^$|pattern")|
    # method of contact
    !str_detect(str_to_lower(ae2$AERESP01),"in person|telephone|electronic"),][,-c(1,3,5:13)] %>%
    {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
    reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "ae2",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data2) && is_empty(ae2$Subject)){knitr::asis_output(colorize("AE2 is empty","red"))}`

`r if(is.character(params$data2)){knitr::asis_output("1. AEDTC02(Update date) should not be blank")}` `r if(is.character(params$data2)){colorize(ae2[str_detect(ae2$AEDTC02,"^$|pattern|NA"),]$Subject,"red")}`

`r if(is.character(params$data2)){knitr::asis_output("2. Length of AEDTC02(Update date) should be")}` `r if(is.character(params$data2)){knitr::asis_output("10")}` `r if(is.character(params$data2)){colorize(ae2[(str_length(ae2$AEDTC02) != 10),]$Subject,"red")}`

`r if(is.character(params$data2)){knitr::asis_output("3. AEORES07(UPDATES/FOLLOW-UP: details) should not be blank")}` `r if(is.character(params$data2)){colorize(ae2[str_detect(ae2$AEORES07,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data2)){knitr::asis_output("4. AERESP01(UPDATES/FOLLOW-UP: method of contact) should be In person, Telephone or Electronic")}` `r if(is.character(params$data2)){colorize(ae2[!str_detect(str_to_lower(ae2$AERESP01),"in person|telephone|electronic"),]$Subject,"red")}`

```{r eval = F}
# cm2 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\089\cm2.sas7bdat)"))
# cm2 <- read_sas(params$data3)
# cm2 <- cm2[order(cm2$Subject),]
```

```{r eval = F}
# cm2[ae1[ae1$AEORES06 == "Yes",]$Subject == cm2$Subject,][,-c(1,3)] %>% 
#   datatable(extensions = c('FixedColumns','Scroller'), options = list(deferRender = TRUE, scrollY = 250, scroller = TRUE,dom = 't',scrollX = TRUE,fixedColumns = list(leftColumns = 2))
# )
```

<!-- > "**`r if(is.character(params$data3) && is_empty(cm2$Subject)){"CM2 is empty"}`**" -->

<!-- > "Subjects taking medications in AE1 should appear in CM2 **`r if((is.character(params$data3) & is.character(params$data1))){cm2[ae1[ae1$AEORES06 == "Yes",]$Subject == cm2$Subject,]$Subject}`**" -->

<!-- # DE Review -->

`r if(is.character(params$data4)){knitr::asis_output("# **DE Review**")}`

`r if(is.character(params$data4)){htmltools::a("Device Incident Report",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_DIR_RevA.pdf")}`

<!-- [Device Incident Report](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_DIR_RevA.pdf) -->

```{r Load de, eval = is.character(params$data4)}
# de <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\111\de.sas7bdat)"))
de <- read_sas(params$data4)
de <- de %>%
      filter(!str_detect(DEYN01,regex("CHECK HERE IF NO DATA RECORDED|no_data_recorded",ignore_case = T))) %>%
      # mutate(Subject = as.character(Subject)) %>%
      arrange(Subject)
```

```{r de, eval = is.character(params$data4)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('de', 'de.csv')"
    ),
de[
# Date incident first noticed
(is.na(de$DEDTC02) | str_detect(de$DEDTC02,"^$|pattern"))    |
# Length of Date incident first noticed
str_length(de$DEDTC02) != median(str_length(de$DEDTC02),na.rm = T)  |
# Time Incident First Noticed
str_detect(de$DETM01,"^$|pattern") & !str_detect(de$DESPID13,regex("Time Unknown|UNK",ignore_case = T)) |
# Check all that are involved in this incident
str_detect(de$DESPID07,"^$|pattern") & str_detect(de$DESPID08,"^$|pattern") & str_detect(de$DESPID09,"^$|pattern") & str_detect(de$DESPID10,"^$|pattern") & str_detect(de$DESPID11,"^$|pattern") & str_detect(de$DESPID12,"^$|pattern") |
# Reader
str_detect(de$DESPID07,regex("Reader",ignore_case = T)) & str_detect(de$DESPID01,"^$|pattern") |
# Sensor
(str_detect(de$DESPID08,regex("Sensor",ignore_case = T)) & (str_detect(de$DESPID02,"^$|pattern") | str_detect(de$DESPID14,"^$|pattern") | str_detect(de$DESPID15,"^$|pattern"))) |
# Length Of Sensor Serial Number
str_detect(de$DESPID08,regex("Sensor",ignore_case = T)) & (str_length(de$DESPID14) != median(str_length(de$DESPID14),na.rm = T)) |
# Other
str_detect(de$DESPID12,regex("Other",ignore_case = T)) & str_detect(de$DESPID06,"^$|pattern") |
# Was there a message on the meter/reader at the time of the incident?  
!str_detect(de$DEORES01,regex("Yes|No",ignore_case = T))                                     |
# If yes
str_detect(de$DEORES01,regex("Yes",ignore_case = T)) & str_detect(de$DETXT02,"^$|pattern") |
# Describe the incident and What was the subject/staff doing at the time the incident occurred?
str_detect(de$DEORES02,"^$|pattern") | str_detect(de$DEORES03,"^$|pattern")|
# Did the incident occur more than once?
!str_detect(de$DEORES04,regex("Yes|No",ignore_case = T))                                          |
# if yes, How many
str_detect(de$DEORES04,regex("Yes",ignore_case = T)) & str_detect(de$DETXT03,"^$|pattern")|
# Describe what was done to resolve the incident
str_detect(de$DEORES05,"^$|pattern") & str_detect(de$DEORES06,"^$|pattern") & str_detect(de$DEORES07,"^$|pattern") & str_detect(de$DEORES08,"^$|pattern") & str_detect(de$DEORES09,"^$|pattern") |
# If other, please specify
str_detect(str_to_lower(de$DEORES09),"other") & str_detect(de$DETXT04,"^$|pattern") |
# Could the part(s) involved in this incident continue to be used successfully?
str_detect(de$DEORES21,"^$|pattern")|
# Did the incident result in an Adverse Event?
!str_detect(de$DEORES10,regex("Yes|No",ignore_case = T))|
# Could the incident have led to a Serious Adverse Event?
!str_detect(de$DEORES11,regex("Yes|No",ignore_case = T)) |
# Did the incident fit any of the events listed below?
(!str_detect(de$DEORES12,regex("Yes|No",ignore_case = T)) |
str_detect(de$DEORES09,regex("Other",ignore_case = T)) & str_detect(de$DETXT04,"^$|pattern")) |
# Sensor Replaced
((str_detect(de$DEORES05,"[:alpha:]") | str_detect(de$DEORES06,"[:alpha:]")) & (str_detect(de$DESPID02,"^$|pattern") | str_detect(de$DESPID08,"^$|pattern") | str_detect(de$DESPID14,"^$|pattern") | str_detect(de$DESPID15,"^$|pattern")))  |
# Reader Replaced
str_detect(de$DEORES07,"[:alpha:]") & (str_detect(de$DESPID01,"^$|pattern") | str_detect(de$DESPID07,"^$|pattern")),][,-c(1,3,5:13)] %>% 
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "de",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data4) && is_empty(de$Subject)){knitr::asis_output(colorize("DE is empty","red"))}`

`r if(is.character(params$data4)){knitr::asis_output("1. DEDTC02(Date incident first noticed) should not be blank")}` `r if(is.character(params$data4)){colorize(de[(is.na(de$DEDTC02) | str_detect(de$DEDTC02,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("2. Length of DEDTC02(Date incident first noticed) should be")}` `r if(is.character(params$data4)){median(str_length(de$DEDTC02),na.rm = T)}``r if(is.character(params$data4)){colorize(de[str_length(de$DEDTC02) != median(str_length(de$DEDTC02),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("3. DETM01(Time Incident First Noticed) DESPID13 should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DETM01,"^$|pattern") & !str_detect(de$DESPID13,regex("Time Unknown|UNK",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("4. DESPID07(Reader) DESPID08(Sensor) DESPID09(Adhesive) DESPID10(Meter) DESPID11(Strip) DESPID12(Others) should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DESPID07,"^$|pattern") & str_detect(de$DESPID08,"^$|pattern") & str_detect(de$DESPID09,"^$|pattern") & str_detect(de$DESPID10,"^$|pattern") & str_detect(de$DESPID11,"^$|pattern") & str_detect(de$DESPID12,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("5. DESPID07(Reader) DESPID01(Reader serial number) should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DESPID07,regex("Reader",ignore_case = T)) & str_detect(de$DESPID01,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("6. If DEORES07(Reader replaced) is not blank, DESPID01(Reader serial number) and DESPID07(Reader) should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DEORES07,"[:alpha:]") & (str_detect(de$DESPID01,"^$|pattern") | str_detect(de$DESPID07,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("7. DESPID08(Sensor) DESPID02(Sensor Number) DESPID14(Sensor Serial Number), and DESPID15(Sensor Lot Number) should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DESPID08,regex("Sensor",ignore_case = T)) & (str_detect(de$DESPID02,"^$|pattern") | str_detect(de$DESPID14,"^$|pattern") | str_detect(de$DESPID15,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("8. The length of DESPID14(Sensor Serial Number) should be")}` `r if(is.character(params$data4)){median(str_length(de$DESPID14),na.rm = T)}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DESPID08,regex("Sensor",ignore_case = T)) & (str_length(de$DESPID14) != median(str_length(de$DESPID14),na.rm = T)),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("9. If DEORES05(Sensor Removed) or  DEORES06(Sensor Replaced) is not blank, DESPID02(Sensor Number),DESPID08(Sensor),DESPID14(Sensor Serial Number),and DESPID15(Sensor Lot Number) should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[(str_detect(de$DEORES05,"[:alpha:]") | str_detect(de$DEORES06,"[:alpha:]")) & (str_detect(de$DESPID02,"^$|pattern") | str_detect(de$DESPID08,"^$|pattern") | str_detect(de$DESPID14,"^$|pattern") | str_detect(de$DESPID15,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("10. DESPID12(Other) DESPID06(Others Please Specify) should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DESPID12,regex("Other",ignore_case = T)) & str_detect(de$DESPID06,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("11. DEORES01(Was there a message on the meter/reader at the time of the incident?) should be either Yes or No")}` `r if(is.character(params$data4)){colorize(de[!str_detect(de$DEORES01,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("12. If DEORES01(Was there a message on the meter/reader at the time of the incident?) is Yes, DETXT02(Yes - Message:) should not be blank")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DEORES01,regex("Yes",ignore_case = T)) & str_detect(de$DETXT02,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("13. DEORES02(Describe the incident) and DEORES03(What was the subject/staff doing at the time the incident occurred?) should not be blank")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DEORES02,"^$|pattern") | str_detect(de$DEORES03,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("14. DEORES04(Did the incident occur more than once?) should be either Yes or No")}` `r if(is.character(params$data4)){colorize(de[!str_detect(de$DEORES04,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("15. If DEORES04(Did the incident occur more than once?) is yes, DETXT03(Yes-how many times?) should not be blank")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DEORES04,regex("Yes",ignore_case = T)) & str_detect(de$DETXT03,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("16. DEORES05(Sensor removed) or DEORES06(Sensor replaced) or DEORES07(Reader replaced) DEORES08(No action taken) DEORES09(other) should not be blank at the same time")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DEORES05,"^$|pattern") & str_detect(de$DEORES06,"^$|pattern") & str_detect(de$DEORES07,"^$|pattern") & str_detect(de$DEORES08,"^$|pattern") & str_detect(de$DEORES09,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("17. If DEORES09(other) is Other, DETXT04 should not be blank")}` `r if(is.character(params$data4)){colorize(de[str_detect(str_to_lower(de$DEORES09),regex("Other",ignore_case = T)) & str_detect(de$DETXT04,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("18. DEORES21(Could the part(s) involved in this incident continue to be used successfully?) should not be blank")}` `r if(is.character(params$data4)){colorize(de[str_detect(de$DEORES21,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("19. DEORES10(Did the incident result in an Adverse Event?) should be either Yes or No")}` `r if(is.character(params$data4)){colorize(de[!str_detect(de$DEORES10,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("20. DEORES11(Could the incident have led to a Serious Adverse Event?) should be either Yes or No")}` `r if(is.character(params$data4)){colorize(de[!str_detect(de$DEORES11,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data4)){knitr::asis_output("21. DEORES12(Did the incident fit any of the events listed below?) should be either Yes or No")}` `r if(is.character(params$data4)){colorize(de[!str_detect(de$DEORES12,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

<!-- # DM Review -->
`r if(is.character(params$data5)){knitr::asis_output("# **DM Review**")}`

`r if(is.character(params$data5)){htmltools::a("Subject Characteristics",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf")}`

<!-- [Subject Characteristics](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf) -->

```{r Load dm, eval = is.character(params$data5)}
# dm <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\089\dm.sas7bdat)"))
dm <- read_sas(params$data5)
dm <- dm %>% 
      # mutate(Subject = as.character(Subject)) %>%
      arrange(Subject)
```

```{r dm, eval = is.character(params$data5)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('dm', 'dm.csv')"
    ),
dm[
# Visit Date
(is.na(dm$VISITDTC) | str_detect(dm$VISITDTC,"^$|pattern"))   |
# Length of Visit Date
str_length(dm$VISITDTC) != median(str_length(dm$VISITDTC),na.rm = T)   |
# Sex  
!str_detect(dm$SEX,regex("Female|Male",ignore_case = T)) |
# Human Id
(str_detect(dm$DMHUMAN,"^$|pattern") |  is.na(dm$DMHUMAN))   |
# Age  
is.na(dm$AGE) |
# Age Extreme values
str_length(dm$AGE) != median(str_length(dm$AGE),na.rm = T)         |
# Ethnic
!str_detect(dm$ETHNIC,regex("Hispanic or Latino|Not Hispanic or Latino",ignore_case = T)) |
# Race  
!str_detect(dm$RACE,regex("Black or African American|Asian|White|Native Hawaiian or Pacific Islander|American Indian or Alaska Native|Other",ignore_case = T))|
# Race is Other
str_detect(dm$RACE,regex("Other",ignore_case = T)) & str_detect(dm$RACE,"^$|pattern") |
# Dexterity  
!str_detect(dm$DMDEXT,regex("Right|Left|Ambidextrous",ignore_case = T))
    ,][,-c(1,3,5:13)] %>% 
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "dm",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data5) && is_empty(dm$Subject)){knitr::asis_output(colorize("DM is empty","red"))}`

`r if(is.character(params$data5)){knitr::asis_output("1. VISITDTC(Visit Date) should not be blank")}` `r if(is.character(params$data5)){colorize(dm[(is.na(dm$VISITDTC) | str_detect(dm$VISITDTC,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("2. Length of VISITDTC(Visit Date) should be")}` `r if(is.character(params$data5)){median(str_length(dm$VISITDTC),na.rm = T)}` `r if(is.character(params$data5)){colorize(dm[str_length(dm$VISITDTC) != median(str_length(dm$VISITDTC),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("3. SEX(Sex at birth) should be either Female or Male")}` `r if(is.character(params$data5)){colorize(dm[!str_detect(dm$SEX,regex("Female|Male",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("4. DMHUMAN(human ID) should not be blank")}` `r if(is.character(params$data5)){colorize(dm[(str_detect(dm$DMHUMAN,"^$|pattern") |  is.na(dm$DMHUMAN)),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("5. AGE(Age) should not be blank")}` `r if(is.character(params$data5)){colorize(dm[is.na(dm$AGE),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("6. AGE(Age) has extreme values")}` `r if(is.character(params$data5)){colorize(dm[str_length(dm$AGE) != median(str_length(dm$AGE),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("7. ETHNIC(Ethnicity) should be either Hispanic or Latino Not Hispanic or Latino")}` `r if(is.character(params$data5)){colorize(dm[!str_detect(dm$ETHNIC,regex("Hispanic or Latino|Not Hispanic or Latino",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("8. RACE(Race) should be Black or African American, Asian, White, Native Hawaiian or Pacific Islander, American Indian or Alaska Native and Other")}` `r if(is.character(params$data5)){colorize(dm[!str_detect(dm$RACE,regex("Black or African American|Asian|White|Native Hawaiian or Pacific Islander|American Indian or Alaska Native|Other",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("9. RACE(Race) is Other and RACEOTH(Race other specify) should not be blank")}` `r if(is.character(params$data5)){colorize(dm[str_detect(dm$RACE,regex("Other",ignore_case = T)) & str_detect(dm$RACE,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data5)){knitr::asis_output("10. DMDEXT(Dexterity) should be Right, Left and, Ambidextrous")}` `r if(is.character(params$data5)){colorize(dm[!str_detect(dm$DMDEXT,regex("Right|Left|Ambidextrous",ignore_case = T)),]$Subject,"red")}`

<!-- # DU1 Review -->
`r if(is.character(params$data6)){knitr::asis_output("# **DU1 Review**")}`

`r if(is.character(params$data6)){htmltools::a("Sensor Use",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf")}`

<!-- [Sensor Use](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf) -->

```{r Load du1, eval = is.character(params$data6)}
# du1 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\115\du1.sas7bdat)"))
du1 <- read_sas(params$data6)
du1 <- du1 %>%
       filter(!str_detect(DUYN1,regex("CHECK HERE IF NO DATA RECORDED|no_data_recorded",ignore_case = T))) %>%
       # mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r du1, eval = is.character(params$data6)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('du1', 'du1.csv')"
    ),
du1[
# Insertion Date (string)
str_length(du1$DUDTC1) != median(str_length(du1$DUDTC1),na.rm = T) | 
# Insertion Time (24 hr) (string)
str_length(du1$DUTM1) != median(str_length(du1$DUTM1),na.rm = T) |
# Did it puncture the skin? (string)
!str_detect(du1$DUORES2,regex("Yes|No",ignore_case = T)) | 
# Sensor Number
str_detect(du1$DUNUM1,"^$|pattern") | 
# Condition Code (string)    
str_length(du1$DUCD) != median(str_length(du1$DUCD),na.rm = T) |
# Sensor Serial Number (string)
str_length(du1$DUNUM2) != median(str_length(du1$DUNUM2),na.rm = T) |
# PDU/SDU Lot Number(s) and PDU/SDU Lot Number(s) NA (string)
str_detect(du1$DUNUM3,"^$|pattern") & str_detect(du1$DUORES3,"^$|pattern")|
# Length of Insertion Location (string) 
!str_detect(du1$DULOC,regex("RA|LA|RUQ|RLQ|LUQ|LLQ|RPH|LPH|RT|LT|RC|LC|OTH",ignore_case = T)) |
# Relative Position (string)
!str_detect(du1$DUPOS,regex("1=Medial/Anterior|2=Distal/Posterior|3=Superior|4=Inferior|NA",ignore_case = T)) |
# Bleeding
is.na(du1$DUNUM4) |
# Did the subject experience any pain? (string)
!str_detect(du1$DUORES24,regex("Yes|No",ignore_case = T)) |
# If yes, how severe? If yes, describe (string)
str_detect(du1$DUORES24,"Yes") & (!str_detect(du1$DUORES4,regex("1=Slight Pain|2=Mild Pain|3=Moderate Pain|4=Extreme Pain")) | !str_detect(du1$DUORES5,regex("1=Sharp|2=Dull|3=Burning|4=Sharp & Burning|5=Sharp & Pricking|6=Dull & Burning|7=Dull & Pricking|8=Pinch|9=Stinging|99=Other \\(please specify on CRF\\)",ignore_case = T))) |                                  
# Were inserter assembly and insertion processes successful? (string)
!str_detect(du1$DUORES6,regex("Yes|No",ignore_case = T)) |
# If no, select issues
str_detect(du1$DUORES6,"No") & (!str_detect(du1$DUORES7,regex("1=Inserter assembly error \\(never placed on subject\\)|2 = Inserter did not discharge \\(no skin 
puncture\\)|3 =Adhesive failure at insertion|4 = Partial insertion, sensor left on|5 = Partial insertion, sensor removed|99 = Other \\(Please specify on CRF\\)"))) |
# if other, specify
str_detect(du1$DUORES7,regex("other",ignore_case = T)) & str_detect(du1$DUDESC2,"^$|pattern")
,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>% 
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "du1",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data6) && is_empty(du1$Subject)){knitr::asis_output(colorize("DU1 is empty","red"))}`

`r if(is.character(params$data6)){knitr::asis_output("1. Length of DUDTC1(Insertion Date) default is")}` `r if(is.character(params$data6)){median(str_length(du1$DUDTC1),na.rm = T)}`
`r if(is.character(params$data6)){colorize(du1[is.na(du1$DUDTC1) | str_length(du1$DUDTC1) != median(str_length(du1$DUDTC1),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("2. Length of DUTM1(Insertion Time (24 hr)) default is")}` `r if(is.character(params$data6)){median(str_length(du1$DUTM1),na.rm = T)}` `r if(is.character(params$data6)){colorize(du1[str_length(du1$DUTM1) != median(str_length(du1$DUTM1),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("3. DUORES2(Did it puncture the skin?) should be either Yes or No")}` `r if(is.character(params$data6)){colorize(du1[!str_detect(du1$DUORES2,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("4. DUNUM1(Sensor Number) should not be blank")}` `r if(is.character(params$data6)){colorize(du1[str_detect(du1$DUNUM1,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("5. Length of DUCD(Condition Code) default is")}` `r if(is.character(params$data6)){median(str_length(du1$DUCD),na.rm = T)}` `r if(is.character(params$data6)){colorize(du1[str_length(du1$DUCD) != median(str_length(du1$DUCD),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("6. Length of DUNUM2(Sensor Serial Number) default is")}` `r if(is.character(params$data6)){median(str_length(du1$DUNUM2),na.rm = T)}` `r if(is.character(params$data6)){colorize(du1[str_length(du1$DUNUM2) != median(str_length(du1$DUNUM2),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("7. DUNUM3(PDU/SDU Lot Number(s)) and DUORES3(PDU/SDU Lot Number(s) NA) should not be blank at the same time")}` `r if(is.character(params$data6)){colorize(du1[str_detect(du1$DUNUM3,"^$|pattern") & str_detect(du1$DUORES3,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("8. DULOC(Insertion Location) should be RA, LA, RUQ, RLQ, LUQ, LLQ, RPH, LPH, RT, LT, RC, LC, or OTH")}` `r if(is.character(params$data6)){colorize(du1[!str_detect(du1$DULOC,regex("RA|LA|RUQ|RLQ|LUQ|LLQ|RPH|LPH|RT|LT|RC|LC|OTH",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("9. DUPOS (Relative Position) should be 1=Medial/Anterior, 2=Distal/Posterior, 3=Superior, 4=Inferior, or NA")}` `r if(is.character(params$data6)){colorize(du1[!str_detect(du1$DUPOS,regex("1=Medial/Anterior|2=Distal/Posterior|3=Superior|4=Inferior|NA",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("10. DUNUM4 (Bleeding (microliter)) should not be blank")}` `r if(is.character(params$data6)){colorize(du1[is.na(du1$DUNUM4),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("11. DUORES24(Did the subject experience any pain?) should not be blank")}` `r if(is.character(params$data6)){colorize(du1[!str_detect(du1$DUORES24,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("12. DUORES24(Did the subject experience any pain?) if Yes, DUORES4(If yes, how severe?) should be 1=Slight Pain, 2=Mild Pain, 3=Moderate Pain, or 4=Extreme Painand and DUORES5(If yes, describe) should be 1=Sharp, 2=Dull, 3=Burning, 4=Sharp & Burning, 5=Sharp & Pricking, 6=Dull & Burning, 7=Dull & Pricking, 8=Pinch, 9=Stinging, or 99=Other (please specify on CRF)")}` `r if(is.character(params$data6)){colorize(du1[str_detect(du1$DUORES24,"Yes") & (!str_detect(du1$DUORES4,regex("1=Slight Pain|2=Mild Pain|3=Moderate Pain|4=Extreme Pain")) | !str_detect(du1$DUORES5,regex("1=Sharp|2=Dull|3=Burning|4=Sharp & Burning|5=Sharp & Pricking|6=Dull & Burning|7=Dull & Pricking|8=Pinch|9=Stinging|99=Other \\(please specify on CRF\\)",ignore_case = T))),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("13. DUORES6(Were inserter assembly and insertion processes successful?) shoud be either Yes or No")}` `r if(is.character(params$data6)){colorize(du1[!str_detect(du1$DUORES6,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("14. DUORES6(Were inserter assembly and insertion processes successful?) if No, DUORES7(If no, select issue) should be 1=Inserter assembly error (never placed on subject), 2 = Inserter did not discharge (no skin puncture), 3 =Adhesive failure at insertion, 4 = Partial insertion, sensor left on, 5 = Partial insertion, sensor removed, or 99 = Other (Please specify on CRF) and DUDESC2(If other,  specify) should not be blank at the same time")}` `r if(is.character(params$data6)){colorize(du1[str_detect(du1$DUORES6,"No") & (!str_detect(du1$DUORES7,regex("1=Inserter assembly error \\(never placed on subject\\)|2 = Inserter did not discharge \\(no skin puncture\\)|3 =Adhesive failure at insertion|4 = Partial insertion, sensor left on|5 = Partial insertion, sensor removed|99 = Other \\(Please specify on CRF\\)"))),]$Subject,"red")}`

`r if(is.character(params$data6)){knitr::asis_output("15. If DUORES7(if no, select issue) is Other, DUDESC2(If other, specify) should not be blank")}` `r if(is.character(params$data6)){colorize(du1[str_detect(du1$DUORES7,regex("other",ignore_case = T)) & str_detect(du1$DUDESC2,"^$|pattern"),]$Subject,"red")}`

<!-- # DU2 Review -->
`r if(is.character(params$data7)){knitr::asis_output("# **DU2 Review**")}`

`r if(is.character(params$data7)){htmltools::a("Sensor Use",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf")}`

<!-- [Sensor Use](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf) -->

```{r Load du2, eval = is.character(params$data7)}
# du2 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\115\du2.sas7bdat)"))
du2 <- read_sas(params$data7)
du2 <- du2 %>%
       filter(!str_detect(DUORES8,regex("NA",ignore_case = T))) %>%
       # filter(!if_all(DUORES8:DUYN2, ~ str_detect(.x,"^$|pattern"))) %>%
       # mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r du2, eval = is.character(params$data7)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('du2', 'du2.csv')"
    ),
du2[
#  Connection
str_detect(du2$DUORES8,"^$|pattern") |
# Was the sensor startup process successful?
!str_detect(du2$DUORES9,regex("Yes|No",ignore_case = T)) |
# Was the sensor startup process successful? if yes, Date
str_detect(du2$DUORES9,"Yes") & str_detect(du2$DUYN2,"^$|pattern") & is.na(du2$DUDTC2) |
# Was the sensor startup process successful? if yes Time
str_detect(du2$DUORES9,"Yes") & str_detect(du2$DUTM2,"^$|pattern") |
# Number of connection attempts
is.na(du2$DUNUM5) |
# Reader/Phone Serial Number
str_length(du2$DUNUM6) != median(str_length(du2$DUNUM6),na.rm = T) 
      ,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "du2",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data7) && is_empty(du2$Subject)){knitr::asis_output(colorize("DU2 is empty","red"))}`

`r if(is.character(params$data7)){knitr::asis_output("1. DUORES8(Connection) should not be blank")}` `r if(is.character(params$data7)){colorize(du2[str_detect(du2$DUORES8,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data7)){knitr::asis_output("2. DUORES9(Was the sensor startup process successful?) should be either Yes or No")}` `r if(is.character(params$data7)){colorize(du2[!str_detect(du2$DUORES9,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data7)){knitr::asis_output("3. If DUORES9(Was the sensor startup process successful?) is Yes,DUYN2(Same as insertion date) and DUDTC2(If yes, date and time displayed on reader) should not be blank at the same time")}` `r if(is.character(params$data7)){colorize(du2[str_detect(du2$DUORES9,"Yes") & str_detect(du2$DUYN2,"^$|pattern") & is.na(du2$DUDTC2),]$Subject,"red")}`

`r if(is.character(params$data7)){knitr::asis_output("4. If DUORES9(Was the sensor startup process successful?) is Yes, DUTM2(time displayed on reader) should not be blank")}` `r if(is.character(params$data7)){colorize(du2[str_detect(du2$DUORES9,"Yes") & str_detect(du2$DUTM2,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data7)){knitr::asis_output("5. DUNUM5(# of connection attempts) should not be blank")}` `r if(is.character(params$data7)){colorize(du2[is.na(du2$DUNUM5),]$Subject,"red")}`

`r if(is.character(params$data7)){knitr::asis_output("6. Length of DUNUM6(Reader/Phone Serial Number) default is")}` `r if(is.character(params$data7)){median(str_length(du2$DUNUM6))}` `r if(is.character(params$data7)){colorize(du2[str_length(du2$DUNUM6) != median(str_length(du2$DUNUM6)),]$Subject,"red")}`

<!-- # DU3 Review -->
`r if(is.character(params$data8)){knitr::asis_output("# **DU3 Review**")}`

`r if(is.character(params$data8)){htmltools::a("Sensor Use",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf")}`

<!-- [Sensor Use](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf) -->

```{r Load du3, eval = is.character(params$data8)}
# du3 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\114\du3.sas7bdat)"))
du3 <- read_sas(params$data8)
if (any(str_detect(du3$`__STUDYOID`,"083"))) {
  du3 <- du3 %>%
         rename(DUORES15 = DUTM3,
                DUTM3 = DUORES15) %>%
         filter(!if_all(DUORES10:DUORES14, ~ str_detect(.x,"^$|pattern"))) %>% 
         arrange(Subject)
} else {
  du3 <- du3 %>%
         filter(!str_detect(DUORES10,regex("NA",ignore_case = T))) %>%
         # filter(!if_all(DUORES10:DUORES14, ~ str_detect(.x,"^$|pattern"))) %>% 
         arrange(Subject)
}
```

```{r du3, eval = is.character(params$data8)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('du3', 'du3.csv')"
    ),
du3[
# Removal
!str_detect(du3$DUORES10,"Yes|NA") |
# Did the sensor fail early?
!str_detect(du3$DUORES12,regex("Yes|No",ignore_case = T)) |
# Did the sensor fail early? If yes failure mode
str_detect(du3$DUORES12,regex("Yes",ignore_case = T)) & str_detect(du3$DUORES13,"^$|pattern") |
# If yes, was sensor removed at that time?
str_detect(du3$DUORES12,regex("Yes",ignore_case = T)) & str_detect(du3$DUORES14,"^$|pattern") |
# If no, was sensor removed at that time?
str_detect(du3$DUORES12,regex("No",ignore_case = T)) & !str_detect(du3$DUORES14,"^$|pattern") |
# Sensor Removal Date 
is.na(du3$DUDTC3) | str_length(du3$DUDTC3) != median(str_length(du3$DUDTC3),na.rm = T) | 
# The length of Sensor Removal Time
!(str_length(du3$DUORES15) == median(str_length(du3$DUORES15),na.rm = T) | str_detect(du3$DUTM3,"UNK"))  |
# The Sensor Removal Time UNK
!str_detect(du3$DUTM3,"UNK") & str_detect(du3$DUORES15,"^$|pattern") |
# Removed By
!str_detect(du3$DUORES16,"Clinical Staff|Fell/Knocked Off|Study Subject") |
# Removal Comments if yes 
str_detect(du3$DUORES17,regex("Yes",ignore_case = T)) & str_detect(du3$DUCOM,"^$|pattern"),][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "du3",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data8) && is_empty(du3$Subject)){knitr::asis_output(colorize("DU3 is empty","red"))}`

`r if(is.character(params$data8)){knitr::asis_output("1. DUORES10(Removal) should be either Yes or NA")}` `r if(is.character(params$data8)){colorize(du3[!str_detect(du3$DUORES10,"Yes|NA"),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("2. DUORES12(Did the sensor fail early?) should be either Yes or No")}` `r if(is.character(params$data8)){colorize(du3[!str_detect(du3$DUORES12,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("3. If DUORES12(Did the sensor fail early?) is Yes, DUORES13(failure mode) should not be blank")}` `r if(is.character(params$data8)){colorize(du3[str_detect(du3$DUORES12,regex("Yes",ignore_case = T)) & str_detect(du3$DUORES13,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("4. If DUORES12(Did the sensor fail early?) is Yes, DUORES14 (if yes, was sensor removed at that time?) should be either Yes or No")}` `r if(is.character(params$data8)){colorize(du3[str_detect(du3$DUORES12,regex("Yes",ignore_case = T)) & str_detect(du3$DUORES14,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("5. If DUORES12(Did the sensor fail early?) is No, DUORES14 (if no, was sensor removed at that time?) should be blank")}` `r if(is.character(params$data8)){colorize(du3[str_detect(du3$DUORES12,regex("No",ignore_case = T)) & !str_detect(du3$DUORES14,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("6. DUTC3(Sensor Removal Date) should not be NA")}` `r if(is.character(params$data8)){colorize(du3[is.na(du3$DUDTC3),]$Subject,"red")}` `r if(is.character(params$data8)){knitr::asis_output("and the length of DUTC3(Sensor Removal Date) should be")}` `r if(is.character(params$data8)){median(str_length(du3$DUDTC3),na.rm = T)}` `r if(is.character(params$data8)){colorize(du3[is.na(du3$DUDTC3) | str_length(du3$DUDTC3) != median(str_length(du3$DUDTC3),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("7. DUTC3(Sensor Removal Date) range is")}` `r if(is.character(params$data8)){range(du3$DUDTC3,na.rm=T)}`

`r if(is.character(params$data8)){knitr::asis_output("8. The length of time DUORES15(Sensor Removal Time (24hr)) should be")}` `r if(is.character(params$data8)){median(str_length(du3$DUORES15),na.rm = T)}` `r if(is.character(params$data8)){colorize(du3[!(str_length(du3$DUORES15) == median(str_length(du3$DUORES15),na.rm = T) | str_detect(du3$DUTM3,"UNK")) ,]$Subject,"red")}` `r if(is.character(params$data8)){knitr::asis_output("However, if DUORES15(Sensor Removal Time (24hr)) is blank, DUTM3(Sensor Removal Time UNK) should be UNK, so")}` `r if(is.character(params$data8)){colorize(du3[!str_detect(du3$DUTM3,"UNK") & str_detect(du3$DUORES15,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("9. DUORES16(Removed By) should be Study Subject, Clinical Staff, and Fell/Knocked Off")}` `r if(is.character(params$data8)){colorize(du3[!str_detect(du3$DUORES16,"Clinical Staff|Fell/Knocked Off|Study Subject"),]$Subject,"red")}`

`r if(is.character(params$data8)){knitr::asis_output("10. DUORES17(Removal Comments) if yes DUCOM(Removal Comments) should not be blank")}` `r if(is.character(params$data8)){colorize(du3[str_detect(du3$DUORES17,regex("Yes",ignore_case = T)) & str_detect(du3$DUCOM,"^$|pattern"),]$Subject,"red")}`

<!-- # DU4 Review -->
`r if(is.character(params$data11)){knitr::asis_output("# **DU4 Review**")}`

`r if(is.character(params$data11)){htmltools::a("Sensor Use",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf")}`

<!-- [Sensor Use](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf) -->

```{r Load du4, eval = is.character(params$data11)}
# du4 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\102\du4.sas7bdat)"))
du4 <- read_sas(params$data11)
du4 <- du4 %>% 
       filter(!is.na(DUDTC4)) %>% 
       # mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r du4, eval = is.character(params$data11)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('du4', 'du4.csv')"
    ),
du4[
# Site Exam Date
is.na(du4$DUDTC4) | str_length(du4$DUDTC4) != median(str_length(du4$DUDTC4),na.rm = T) |
# Did the subject experience any insertion site symptoms?
!str_detect(du4$DUORES19,regex("Yes|No",ignore_case = T)),][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "du4",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data11) && is_empty(du4$Subject)){knitr::asis_output(colorize("DU4 is empty","red"))}`

`r if(is.character(params$data11)){knitr::asis_output("1. DUTC4(Site Exam Date) should not be NA")}` `r if(is.character(params$data11)){colorize(du4[is.na(du4$DUDTC4),]$Subject,"red")}` `r if(is.character(params$data11)){knitr::asis_output("and the length of DUTC4(Site Exam Date) should be")}` `r if(is.character(params$data11)){median(str_length(du4$DUDTC4),na.rm = T)}` `r if(is.character(params$data11)){colorize(du4[is.na(du4$DUDTC4) | str_length(du4$DUDTC4) != median(str_length(du4$DUDTC4),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data11)){knitr::asis_output("2. DUORES19(Did the subject experience any insertion site symptoms?) should be either Yes or No")}` `r if(is.character(params$data11)){colorize(du4[!str_detect(du4$DUORES19,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

<!-- # DU5 Review -->
`r if(is.character(params$data12)){knitr::asis_output("# **DU5 Review**")}`

`r if(is.character(params$data12)){htmltools::a("Sensor Use",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf")}`

<!-- [Sensor Use](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Sensor_Use_RevA.pdf) -->

```{r Load du5, eval = is.character(params$data12)}
# du5 <- read_sas(gsub("\\\\", "/",r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\102\du5.sas7bdat)"))
du5 <- read_sas(params$data12)
du5 <- du5 %>% 
       filter(!str_detect(DUORES21,"^$|pattern")) %>% 
       # mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r du5, eval = is.character(params$data12)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('du5', 'du5.csv')"
    ),
du5[
# Did the subject or study staff apply one or more over-bandages?
!str_detect(du5$DUORES21,regex("Yes|No",ignore_case = T))  |
# If yes, Date should not be blank or NA
str_detect(du5$DUORES21,regex("Yes",ignore_case = T)) & is.na(du5$DUORES21),][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "du5",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data12) && is_empty(du5$Subject)){knitr::asis_output(colorize("DU5 is empty","red"))}`

`r if(is.character(params$data12)){knitr::asis_output("1. DUORES21(Did the subject or study staff apply one or more over-bandages?) should be either Yes or No")}` `r if(is.character(params$data12)){colorize(du5[!str_detect(du5$DUORES21,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data12)){knitr::asis_output("2. If DUORES21 is yes, DUDTC5(If yes, date first applied:) should not be NA")}` `r if(is.character(params$data12)){colorize(du5[str_detect(du5$DUORES21,regex("Yes",ignore_case = T)) & is.na(du5$DUORES21),]$Subject,"red")}`

<!-- # IE Review -->
`r if(is.character(params$data13)){knitr::asis_output("# **IE Review**")}`

`r if(is.character(params$data13)){htmltools::a("Subject Characteristics",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf")}`

<!-- [Subject Characteristics](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf) -->

```{r Load ie, eval = is.character(params$data13)}
# ie <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\096\ie.sas7bdat)"))
ie <- read_sas(params$data13)
ie <- ie %>% 
      # mutate(Subject = as.character(Subject)) %>%
      arrange(Subject)
```

```{r ie, eval = is.character(params$data13)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('ie', 'ie.csv')"
    ),
ie[
# Date Eligibility verified and Informed Consent signed
is.na(ie$IEDTC) | str_length(ie$IEDTC) != median(str_length(ie$IEDTC),na.rm = T),][,-c(1,3,5:13)] %>% 
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "ie",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data13) && is_empty(ie$Subject)){knitr::asis_output(colorize("IE is empty","red"))}`

`r if(is.character(params$data13)){knitr::asis_output("1. IEDTC(Date Eligibility verified and Informed Consent signed) should not be NA")}` `r if(is.character(params$data13)){colorize(ie[is.na(ie$IEDTC),]$Subject,"red")}` `r if(is.character(params$data13)){knitr::asis_output("and the length of IEDTC(Site Exam Date) should be")}` `r if(is.character(params$data13)){median(str_length(ie$IEDTC),na.rm = T)}` `r if(is.character(params$data13)){colorize(ie[is.na(ie$IEDTC) | str_length(ie$IEDTC) != median(str_length(ie$IEDTC),na.rm = T),]$Subject,"red")}`

<!-- # MH Review -->
`r if(is.character(params$data14)){knitr::asis_output("# **MH Review**")}`

`r if(is.character(params$data14)){htmltools::a("Subject Characteristics",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf")}`

<!-- [Subject Characteristics](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf) -->

```{r Load mh, eval = is.character(params$data14)}
# mh <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\091\mh.sas7bdat)"))
mh <- read_sas(params$data14)
mh <- mh %>% 
      # mutate(Subject = as.character(Subject)) %>%
      arrange(Subject)
```

```{r mh, eval = is.character(params$data14)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('mh', 'mh.csv')"
    ),
mh[
# Is the subject taking anticoagulant medications?
! str_detect(mh$MHORRES1,regex("Yes|No",ignore_case = T)) |
# Is the subject diabetic?
! str_detect(mh$MHORRES2,regex("Yes|No",ignore_case = T)) |
# If yes,Month Diagnosed with Diabetes,Year diagnosed with diabetes,Type of diabetes
str_detect(mh$MHORRES2,regex("Yes",ignore_case = T)) & (!str_detect(mh$MHDTC1,regex("Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec",ignore_case = T)) | str_detect(mh$MHDTC2,"^$|pattern") | !str_detect(mh$MHORRES3,regex("Type 1|Type 2",ignore_case = T))),][,-c(1,3,5:13)] %>% 
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "mh",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data14) && is_empty(mh$Subject)){knitr::asis_output(colorize("MH is empty","red"))}`

`r if(is.character(params$data14)){knitr::asis_output("1. MHORRES1(Is the subject taking anticoagulant medications?) should be either Yes or No")}` `r if(is.character(params$data14)){colorize(mh[! str_detect(mh$MHORRES1,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data14)){knitr::asis_output("2. MHORRES2(Is the subject diabetic?) should be either Yes or No")}` `r if(is.character(params$data14)){colorize(mh[! str_detect(mh$MHORRES2,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data14)){knitr::asis_output("3. If MHORRES2(Is the subject diabetic?) is yes, MHDTC1(Month Diagnosed with Diabetes), MHDTC2(Year diagnosed with diabetes), and MHORRES3(Type of diabetes) should not be blank at the same time")}` `r if(is.character(params$data14)){colorize(mh[str_detect(mh$MHORRES2,regex("Yes",ignore_case = T)) & (!str_detect(mh$MHDTC1,regex("Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec",ignore_case = T)) | str_detect(mh$MHDTC2,"^$|pattern") | !str_detect(mh$MHORRES3,regex("Type 1|Type 2",ignore_case = T))),]$Subject,"red")}`

<!-- # PD Review -->
`r if(is.character(params$data9)){knitr::asis_output("# **PD Review**")}`

`r if(is.character(params$data9)){htmltools::a("Protocol Deviation Report",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_PD_RevA.pdf")}`
<!-- [Protocol Deviation Report](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_PD_RevA.pdf) -->

```{r Load pd, eval = is.character(params$data9)}
# pd <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\119\pd.sas7bdat)"))
pd <- read_sas(params$data9)
pd <- pd %>% 
      filter(!str_detect(DVYN,regex("CHECK HERE IF NO DATA RECORDED|no_data_recorded",ignore_case = T))) %>%
       # mutate(Subject = as.character(Subject)) %>% 
      arrange(Subject)
```

```{r pd, eval = is.character(params$data9)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('pd', 'pd.csv')"
    ),
# Date of Deviation
pd[str_length(pd$DVDTC1) != median(str_length(pd$DVDTC1),na.rm = T) |
# Protocol Deviation Report Number 
str_length(pd$DVSEQ01) != median(str_length(pd$DVSEQ01),na.rm = T)  |
# Name of person reporting (print)
str_detect(pd$DVRPTR,"^$|pattern")                                  |
# Date Reported
str_length(pd$DVDTC2) != median(str_length(pd$DVDTC2),na.rm = T) | is.na(pd$DVDTC2)    |
# Type of deviation
(str_detect(pd$DVTERM,"^$|pattern")  & str_detect(pd$DVCOM1,"^$|pattern"))  |                     
# Description of Deviation
(str_detect(pd$DVDESC1,"^$|pattern")  & str_detect(pd$DVDESC2,"^$|pattern") & str_detect(pd$DVDESC3,"^$|pattern"))                                         |
# Classification of deviation
!str_detect(str_to_lower(pd$DVCAT01),"minor deviation|serious breach|urgent safety measure") |
# Subject withdrawn from study
!str_detect(pd$DVACT1,regex("Yes|No",ignore_case = T)) |
# Inform Ethics Committee/IRB  
!str_detect(pd$DVACT2,regex("Yes|No",ignore_case = T)) |
# Protocol amendment required
!str_detect(pd$DVACT3,regex("Yes|No",ignore_case = T)) |
# Other (please specify)
!str_detect(pd$DVACT4,regex("Yes|No",ignore_case = T)) |
# Other (please specify) if Yes,
str_detect(pd$DVACT4,regex("Yes",ignore_case = T)) & str_detect(pd$DVCOM2,"^$|pattern") |
# Action taken to prevent similar future deviation
(str_detect(pd$DVDESC4,"^$|pattern")  & str_detect(pd$DVDESC5,"^$|pattern") & str_detect(pd$DVDESC6,"^$|pattern"))                                              |
# Principal Investigator Acknowledgement: Date
str_length(pd$DVDTC3) != median(str_length(pd$DVDTC3),na.rm = T) | is.na(pd$DVDTC3),][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "pd",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data9) && is_empty(pd$Subject)){knitr::asis_output(colorize("PD is empty","red"))}`

`r if(is.character(params$data9)){knitr::asis_output("1. The length of DVDTC1(Date of Deviation) should be")}` `r if(is.character(params$data9)){median(str_length(pd$DVDTC1),na.rm = T)}` `r if(is.character(params$data9)){colorize(pd[str_length(pd$DVDTC1) != median(str_length(pd$DVDTC1),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("2. The length of DVSEQ01(Protocol Deviation Report Number) should be")}` `r if(is.character(params$data9)){median(str_length(pd$DVSEQ01),na.rm = T)}` `r if(is.character(params$data9)){colorize(pd[str_length(pd$DVSEQ01) != median(str_length(pd$DVSEQ01),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("3. DVRPTR(Name of person reporting) should not be blank")}` `r if(is.character(params$data9)){colorize(pd[str_detect(pd$DVRPTR,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("4. The length of DVDTC2(Date Reported) should be")}` `r if(is.character(params$data9)){median(str_length(pd$DVDTC2),na.rm = T)}` `r if(is.character(params$data9)){colorize(pd[str_length(pd$DVDTC2) != median(str_length(pd$DVDTC2),na.rm = T) | is.na(pd$DVDTC2),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("5. DVTERM(Type of deviation) and DVCOM1(Other specify) should not be blank at the same time")}` `r if(is.character(params$data9)){colorize(pd[str_detect(pd$DVTERM,"^$|pattern")  & str_detect(pd$DVCOM1,"^$|pattern") ,]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("6. DVDESC1~3(Description of Deviation) should not be blank at the same time")}` `r if(is.character(params$data9)){colorize(pd[str_detect(pd$DVDESC1,"^$|pattern")  & str_detect(pd$DVDESC2,"^$|pattern") & str_detect(pd$DVDESC3,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("7. DVCAT01(Classification of deviation) should be minor deviation,serious breach,or urgent safety measure, so")}` `r if(is.character(params$data9)){colorize(pd[!str_detect(str_to_lower(pd$DVCAT01),"minor deviation|serious breach|urgent safety measure"),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("8. DVACT1(Subject withdrawn from study) should be Yes or No")}` `r if(is.character(params$data9)){colorize(pd[!str_detect(pd$DVACT1,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("9. DVACT2(Inform Ethics Committee/IRB) should be Yes or No")}` `r if(is.character(params$data9)){colorize(pd[!str_detect(pd$DVACT2,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("10. DVACT3(Protocol amendment required) should be Yes or No")}` `r if(is.character(params$data9)){colorize(pd[!str_detect(pd$DVACT3,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("11. DVACT4(Other (please specify)) should be Yes or No")}` `r if(is.character(params$data9)){colorize(pd[!str_detect(pd$DVACT4,"Yes|No"),]$Subject,"red")}` `r if(is.character(params$data9)){knitr::asis_output("and DVACT4(Other (please specify)) if yes (DVCOM2) should not be blank")}` `r if(is.character(params$data9)){colorize(pd[str_detect(pd$DVACT4,regex("Yes",ignore_case = T)) & str_detect(pd$DVCOM2,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("12. DVDESC4~6(Action taken to prevent similar future deviation) should not be blank at the same time")}` `r if(is.character(params$data9)){colorize(pd[str_detect(pd$DVDESC4,"^$|pattern")  & str_detect(pd$DVDESC5,"^$|pattern") & str_detect(pd$DVDESC6,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data9)){knitr::asis_output("13. The length of DVDTC3(Principal Investigator Acknowledgement: Date) should be")}` `r if(is.character(params$data9)){median(str_length(pd$DVDTC3),na.rm = T)}` `r if(is.character(params$data9)){colorize(pd[str_length(pd$DVDTC3) != median(str_length(pd$DVDTC3),na.rm = T) | is.na(pd$DVDTC3),]$Subject,"red")}`

<!-- # VS Review -->
`r if(is.character(params$data10)){knitr::asis_output("# **VS Review**")}`

`r if(is.character(params$data10)){htmltools::a("Subject Characteristics",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf")}`

<!-- [Subject Characteristics](//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_Characteristics_RevA.pdf) -->

```{r Load vs, eval = is.character(params$data10)}
# vs <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\095\vs.sas7bdat)"))
vs <- read_sas(params$data10)
vs <- vs %>% 
      # mutate(Subject = as.character(Subject)) %>% 
      arrange(Subject)
```

```{r vs, eval = is.character(params$data10)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('vs', 'vs.csv')"
    ),
vs[
# Height (feet) 
(is.na(vs$VSORRES1) | str_detect(vs$VSORRES1,"^$|pattern")) |
# # Height (feet) extreme values
# ((vs$VSORRES1 < quantile(vs$VSORRES1,probs = 0.25,names = F,na.rm = T) -1.5*IQR(vs$VSORRES1,na.rm = T) | vs$VSORRES1 > quantile(vs$VSORRES1,probs = 0.75,names = F,na.rm = T) + 1.5*IQR(vs$VSORRES1,na.rm = T)) & str_length(vs$VSORRES1) != 1)               |
# Height (inches)
(is.na(vs$VSORRES2) | str_detect(vs$VSORRES2,"^$|pattern")) |
# Height (inches) extreme values
!(vs$VSORRES2 %in% seq(0,11))                               |
# Weight (lbs)
(is.na(vs$VSORRES3) | str_detect(vs$VSORRES3,"^$|pattern"))   
# Weight (lbs) extreme values
# ((vs$VSORRES3 < quantile(vs$VSORRES3,probs = 0.25,names = F,na.rm = T) -1.5*IQR(vs$VSORRES3,na.rm = T) | vs$VSORRES3 > quantile(vs$VSORRES3,probs = 0.75,names = F,na.rm = T) + 1.5*IQR(vs$VSORRES3,na.rm = T)) & str_length(vs$VSORRES3) != 3)
,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE,defaultPageSize = 6, resizable = TRUE,elementId = "vs",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data10) && is_empty(vs$Subject)){knitr::asis_output("VS is empty")}`

`r if(is.character(params$data10)){knitr::asis_output("1. VSORRES1(Height (feet)) should not be blank")}` `r if(is.character(params$data10)){colorize(vs[is.na(vs$VSORRES1) | str_detect(vs$VSORRES1,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data10)){knitr::asis_output("2. VSORRES2(Height (inches)) should not be blank")}` `r if(is.character(params$data10)){colorize(vs[is.na(vs$VSORRES2) | str_detect(vs$VSORRES2,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data10)){knitr::asis_output("3. VSORRES1(Height (inches)) has extreme values")}` `r if(is.character(params$data10)){colorize(vs[!(vs$VSORRES2 %in% seq(0,11)),]$Subject,"red")}`

<!-- # DT2 Review -->
`r if(is.character(params$data15)){knitr::asis_output("# **DT2 Review**")}`

`r if(is.character(params$data15)){htmltools::a("Adhesive Log",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_AdhesiveLog_RevA.pdf")}`

```{r Load dt2, eval = is.character(params$data15)}
# dt2 <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\106\dt2.sas7bdat)"))
dt2 <- read_sas(params$data15)
dt2 <- dt2 %>%
       mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r dt2, eval = is.character(params$data15)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('dt2', 'dt2.csv')"
    ),
dt2[
# Adhesive Mount #
str_detect(dt2$DTALSEQ,"^$|pattern") | 
# Attachment Location
!str_detect(dt2$DTALLOC,regex("RA|LA|RUQ|LUQ|RLQ|LLQ|RPH|LPH|RT|LT|RC|LC|OTH",ignore_case = T)) |
# Adhesive Mount ID
str_detect(dt2$DTALMID,"^$|pattern") | str_length(dt2$DTALMID) != median(str_length(dt2$DTALMID),na.rm = T) |
# Adhesive Lot Number
str_detect(dt2$DTALNUM,"^$|pattern") | str_length(dt2$DTALNUM) != median(str_length(dt2$DTALNUM),na.rm = T) |
# Date Applied
str_length(dt2$DTALSDTC) != median(str_length(dt2$DTALSDTC),na.rm = T) | 
# Time Applied
str_length(dt2$DTALSTM) != median(str_length(dt2$DTALSTM),na.rm = T) | !str_detect(dt2$DTALSTM,":") |
# Date Removed
str_length(dt2$DTALEDTC) != median(str_length(dt2$DTALEDTC),na.rm = T) |
# Time Removed
str_length(dt2$DTALETM) != median(str_length(dt2$DTALETM),na.rm = T) | !str_detect(dt2$DTALETM,":"),][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE, defaultPageSize = 6, resizable = TRUE,elementId = "dt2",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data15) && is_empty(dt2$Subject)){knitr::asis_output("DT2 is empty")}`

`r if(is.character(params$data15)){knitr::asis_output("1. DTALSEQ(Adhesive Mount #) should not be blank")}` `r if(is.character(params$data15)){colorize(dt2[str_detect(dt2$DTALSEQ,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data15)){knitr::asis_output("2. DTALLOC(Attachment Location) should be RA,LA,RUQ,LUQ,RLQ,LLQ,RPH,LPH,RT,LT,RC,LC and OTH")}` `r if(is.character(params$data15)){colorize(dt2[!str_detect(dt2$DTALLOC,regex("RA|LA|RUQ|LUQ|RLQ|LLQ|RPH|LPH|RT|LT|RC|LC|OTH",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data15)){knitr::asis_output("3. DTALMID(Adhesive Mount ID) should not be blank or has extreme values")}` `r if(is.character(params$data15)){colorize(dt2[str_detect(dt2$DTALMID,"^$|pattern") | str_length(dt2$DTALMID) != median(str_length(dt2$DTALMID),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data15)){knitr::asis_output("4. DTALNUM(Adhesive Lot Number) should not be blank or has extreme values")}` `r if(is.character(params$data15)){colorize(dt2[str_detect(dt2$DTALNUM,"^$|pattern") | str_length(dt2$DTALNUM) != median(str_length(dt2$DTALNUM),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data15)){knitr::asis_output("5. The length of DTALSDTC(Date Applied) should be")}` `r if(is.character(params$data15)){median(str_length(dt2$DTALSDTC),na.rm = T)}` `r if(is.character(params$data15)){colorize(dt2[str_length(dt2$DTALSDTC) != median(str_length(dt2$DTALSDTC),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data15)){knitr::asis_output("6. The length of DTALSTM(Time Applied) should be")}` `r if(is.character(params$data15)){median(str_length(dt2$DTALSTM),na.rm = T)}` `r if(is.character(params$data15)){colorize(dt2[str_length(dt2$DTALSTM) != median(str_length(dt2$DTALSTM),na.rm = T) | !str_detect(dt2$DTALSTM,":"),]$Subject,"red")}`

`r if(is.character(params$data15)){knitr::asis_output("7. The length of DTALEDTC(Date Removed) should be")}` `r if(is.character(params$data15)){median(str_length(dt2$DTALEDTC),na.rm = T)}` `r if(is.character(params$data15)){colorize(dt2[str_length(dt2$DTALEDTC) != median(str_length(dt2$DTALEDTC),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data15)){knitr::asis_output("8. The length of DTALETM(Time Removed) should be")}` `r if(is.character(params$data15)){median(str_length(dt2$DTALETM),na.rm = T)}` `r if(is.character(params$data15)){colorize(dt2[str_length(dt2$DTALETM) != median(str_length(dt2$DTALETM),na.rm = T) | !str_detect(dt2$DTALETM,":"),]$Subject,"red")}`

<!-- # DT3 Review -->
`r if(is.character(params$data16)){knitr::asis_output("# **DT3 Review**")}`

`r if(is.character(params$data16)){htmltools::a("Adhesive Log",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_AdhesiveLog_RevA.pdf")}`

```{r Load dt3, eval = is.character(params$data16)}
# dt3 <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\106\dt3.sas7bdat)"))
dt3 <- read_sas(params$data16)
dt3 <- dt3 %>%
       mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r dt3, eval = is.character(params$data16)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('dt3', 'dt3.csv')"
    ),
dt3[
# Site Exam Date
str_length(dt3$DTALDTC1) != median(str_length(dt3$DTALDTC1),na.rm = T) | 
# Did the subject experience any insertion site symptoms?
!str_detect(dt3$DTORRES1,regex("Yes|No",ignore_case = T))
,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE, defaultPageSize = 6, resizable = TRUE,elementId = "dt3",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data16) && is_empty(dt3$Subject)){knitr::asis_output("DT3 is empty")}`

`r if(is.character(params$data16)){knitr::asis_output("1. The length of DTALDTC1(Site Exam Date) should be")}` `r if(is.character(params$data16)){median(str_length(dt3$DTALDTC1),na.rm = T)}` `r if(is.character(params$data16)){colorize(dt3[str_length(dt3$DTALDTC1) != median(str_length(dt3$DTALDTC1),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data16)){knitr::asis_output("2. DTORRES1(Did the subject experience any insertion site symptoms?) should be either Yes or No")}` `r if(is.character(params$data16)){colorize(dt3[!str_detect(dt3$DTORRES1,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

<!-- # DT4 Review -->
`r if(is.character(params$data17)){knitr::asis_output("# **DT4 Review**")}`

`r if(is.character(params$data17)){htmltools::a("Adhesive Log",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_AdhesiveLog_RevA.pdf")}`

```{r Load dt4, eval = is.character(params$data17)}
# dt4 <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\106\dt4.sas7bdat)"))
dt4 <- read_sas(params$data17)
dt4 <- dt4 %>%
       mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r dt4, eval = is.character(params$data17)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('dt4', 'dt4.csv')"
    ),
dt4[
# Site Exam Date
str_length(dt4$DTALDTC3) != median(str_length(dt4$DTALDTC3),na.rm = T) | 
# Did the subject experience any insertion site symptoms?
!str_detect(dt4$DTORRES3,regex("Yes|No",ignore_case = T))
,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE, defaultPageSize = 6, resizable = TRUE,elementId = "dt4",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data17) && is_empty(dt4$Subject)){knitr::asis_output("DT4 is empty")}`

`r if(is.character(params$data17)){knitr::asis_output("1. The length of DTALDTC3(Site Exam Date) should be")}` `r if(is.character(params$data17)){median(str_length(dt4$DTALDTC3),na.rm = T)}` `r if(is.character(params$data17)){colorize(dt4[str_length(dt4$DTALDTC3) != median(str_length(dt4$DTALDTC3),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data17)){knitr::asis_output("2. DTORRES3(Did the subject experience any insertion site symptoms?) should be either Yes or No")}` `r if(is.character(params$data17)){colorize(dt4[!str_detect(dt4$DTORRES3,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

<!-- # DL2 Review -->
`r if(is.character(params$data18)){knitr::asis_output("# **DL2 Review**")}`

`r if(is.character(params$data18)){htmltools::a("Daily Activity Log",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_DailyActivityLog_RevA.pdf")}`

```{r Load dl2, eval = is.character(params$data18)}
# dl2 <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\106\dl2.sas7bdat)"))
dl2 <- read_sas(params$data18)
dl2 <- dl2 %>%
       mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r dl2, eval = is.character(params$data18)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('dl2', 'dl2.csv')"
    ),
dl2[
# Date of Activity
str_length(dl2$DRDLDTC) != median(str_length(dl2$DRDLDTC),na.rm = T) | 
# Time of Activity
str_length(dl2$DRDLATM) != median(str_length(dl2$DRDLATM),na.rm = T) | !str_detect(dl2$DRDLATM,":") |
# Adhesive #
str_detect(dl2$DRDLSEQ,"^$|pattern") | str_length(dl2$DRDLSEQ) != median(str_length(dl2$DRDLSEQ),na.rm = T) |
# Activity
!str_detect(dl2$DRDLACT,regex("Bathing or showering|Dressing or changing clothes|Housework, yard work or chores|Exercise or swimming|Other",ignore_case = T)) | 
# Activity is Other
str_detect(dl2$DRDLACT,regex("Other",ignore_case = T)) & str_detect(dl2$DRDLACTO,"^$|pattern") |
# Perspiration Level
!str_detect(dl2$DRDLPER,regex("NA|Low|Moderate|Heavy",ignore_case = T)) | 
# Description
!str_detect(dl2$DRDLDESC,regex("Unnoticed|Discomfort|Device loosened or began to come off|Device came off",ignore_case = T))
,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE, defaultPageSize = 6, resizable = TRUE,elementId = "dl2",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data18) && is_empty(dl2$Subject)){knitr::asis_output("DL2 is empty")}`

`r if(is.character(params$data18)){knitr::asis_output("1. The length of DRDLDTC(Date of Activity) should be")}` `r if(is.character(params$data18)){median(str_length(dl2$DRDLDTC),na.rm = T)}` `r if(is.character(params$data18)){colorize(dl2[str_length(dl2$DRDLDTC) != median(str_length(dl2$DRDLDTC),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data18)){knitr::asis_output("2. The length of DRDLATM(Time of Activity) should be")}` `r if(is.character(params$data18)){median(str_length(dl2$DRDLATM),na.rm = T)}` `r if(is.character(params$data18)){colorize(dl2[str_length(dl2$DRDLATM) != median(str_length(dl2$DRDLATM),na.rm = T) | !str_detect(dl2$DRDLATM,":"),]$Subject,"red")}`

`r if(is.character(params$data18)){knitr::asis_output("3. DRDLSEQ(Adhesive #) should not be blank or has extreme values")}` `r if(is.character(params$data18)){colorize(dl2[str_detect(dl2$DRDLSEQ,"^$|pattern") | str_length(dl2$DRDLSEQ) != median(str_length(dl2$DRDLSEQ),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data18)){knitr::asis_output("4. DRDLACT(Activity) should be Bathing or showering, Dressing or changing clothes, Housework, yard work or chores, Exercise or swimming, Other")}` `r if(is.character(params$data18)){colorize(dl2[!str_detect(dl2$DRDLACT,regex("Bathing or showering|Dressing or changing clothes|Housework, yard work or chores|Exercise or swimming|Other",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data18)){knitr::asis_output("5. If DRDLACT(Activity) is Other, DRDLACTO(Other Activity) should not be blank")}` `r if(is.character(params$data18)){colorize(dl2[str_detect(dl2$DRDLACT,regex("Other",ignore_case = T)) & str_detect(dl2$DRDLACTO,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data18)){knitr::asis_output("6. DRDLPER(Perspiration Level) should be NA, Low, Moderate, and Heavy")}` `r if(is.character(params$data18)){colorize(dl2[!str_detect(dl2$DRDLPER,regex("NA|Low|Moderate|Heavy",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data18)){knitr::asis_output("7. DRDLDESC(Description) should be Unnoticed, Discomfort, Device loosened or began to come off, and Device came off")}` `r if(is.character(params$data18)){colorize(dl2[!str_detect(dl2$DRDLDESC,regex("Unnoticed|Discomfort|Device loosened or began to come off|Device came off",ignore_case = T)),]$Subject,"red")}`

<!-- # ML2 Review -->
`r if(is.character(params$data19)){knitr::asis_output("# **ML2 Review**")}`

`r if(is.character(params$data19)){htmltools::a("Meal and Activity Log",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_MAL_RevA.pdf")}`

```{r Load ml2, eval = is.character(params$data19)}
# ml2 <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\106\ml2.sas7bdat)"))
ml2 <- read_sas(params$data19)
ml2 <- ml2 %>%
       mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r ml2, eval = is.character(params$data19)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('ml2', 'ml2.csv')"
    ),
ml2[
# Date
str_length(ml2$MLDTC) != median(str_length(ml2$MLDTC),na.rm = T) | 
# Time
str_length(ml2$MLTM) != median(str_length(ml2$MLTM),na.rm = T) | !str_detect(ml2$MLTM,":") |
# Meal Beverage Snack
(str_detect(ml2$MLORES01,"^$|pattern") &  str_detect(ml2$MLORES02,"^$|pattern") & str_detect(ml2$MLORES03,"^$|pattern")) |
# Walk Cycling Stretching Aerobics Run Weights Other
(str_detect(ml2$MLORES05,"^$|pattern") & str_detect(ml2$MLORES06,"^$|pattern") & str_detect(ml2$MLORES07,"^$|pattern") & str_detect(ml2$MLORES08,"^$|pattern") &  str_detect(ml2$MLORES09,"^$|pattern") & str_detect(ml2$MLORES10,"^$|pattern") & str_detect(ml2$MLORES11,"^$|pattern")) | 
# Activity is Other
str_detect(ml2$MLORES11,regex("Other",ignore_case = T)) & str_detect(ml2$MLOTH,"^$|pattern") 
,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE, defaultPageSize = 6, resizable = TRUE,elementId = "ml2",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data19) && is_empty(ml2$Subject)){knitr::asis_output("ML2 is empty")}`

`r if(is.character(params$data19)){knitr::asis_output("1. The length of MLDTC(Date) should be")}` `r if(is.character(params$data19)){median(str_length(ml2$MLDTC),na.rm = T)}` `r if(is.character(params$data19)){colorize(ml2[str_length(ml2$MLDTC) != median(str_length(ml2$MLDTC),na.rm = T),]$Subject,"red")}`

`r if(is.character(params$data19)){knitr::asis_output("2. The length of MLTM(Time) should be")}` `r if(is.character(params$data19)){median(str_length(ml2$MLTM),na.rm = T)}` `r if(is.character(params$data19)){colorize(ml2[str_length(ml2$MLTM) != median(str_length(ml2$MLTM),na.rm = T) | !str_detect(ml2$MLTM,":"),]$Subject,"red")}`

`r if(is.character(params$data19)){knitr::asis_output("3. MLORES01(Meal), MLORES02(Beverage), and MLORES03(Snack) should not be blank at the same time")}` `r if(is.character(params$data19)){colorize(ml2[(str_detect(ml2$MLORES01,"^$|pattern") &  str_detect(ml2$MLORES02,"^$|pattern") & str_detect(ml2$MLORES03,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data19)){knitr::asis_output("4. MLORES05(Walk) MLORES06(Cycling) MLORES07(Stretching) MLORES08(Aerobics) MLORES09(Run) MLORES10(Weights) MLORES11(Other) should not be blanck at the same time")}` `r if(is.character(params$data19)){colorize(ml2[(str_detect(ml2$MLORES05,"^$|pattern") & str_detect(ml2$MLORES06,"^$|pattern") & str_detect(ml2$MLORES07,"^$|pattern") & str_detect(ml2$MLORES08,"^$|pattern") &  str_detect(ml2$MLORES09,"^$|pattern") & str_detect(ml2$MLORES10,"^$|pattern") & str_detect(ml2$MLORES11,"^$|pattern")),]$Subject,"red")}`

`r if(is.character(params$data19)){knitr::asis_output("5. If MLORES11(Activity) is Other, MLOTH(Other Activity) should not be blank")}` `r if(is.character(params$data19)){colorize(ml2[str_detect(ml2$MLORES11,regex("Other",ignore_case = T)) & str_detect(ml2$MLOTH,"^$|pattern") ,]$Subject,"red")}`

<!-- # SK1 Review -->
`r if(is.character(params$data20)){knitr::asis_output("# **SK1 Review**")}`

`r if(is.character(params$data20)){htmltools::a("Skin Assessment",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_SkinAssess_RevA.pdf")}`

```{r Load sk1, eval = is.character(params$data20)}
# sk1 <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\106\sk1.sas7bdat)"))
sk1 <- read_sas(params$data20)
sk1 <- sk1 %>%
       filter(!str_detect(PEYN,regex("Check Here If No Data Recorded",ignore_case = T))) %>%
       mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r sk1, eval = is.character(params$data20)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('sk1', 'sk1.csv')"
    ),
sk1[
# Date
str_length(sk1$PEDTC) != median(str_length(sk1$PEDTC),na.rm = T),][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE, defaultPageSize = 6, resizable = TRUE,elementId = "sk1",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data20) && is_empty(sk1$Subject)){knitr::asis_output("SK1 is empty")}`

`r if(is.character(params$data20)){knitr::asis_output("1. The length of PEDTC(Date) should be")}` `r if(is.character(params$data20)){median(str_length(sk1$PEDTC),na.rm = T)}` `r if(is.character(params$data20)){colorize(sk1[str_length(sk1$PEDTC) != median(str_length(sk1$PEDTC),na.rm = T),]$Subject,"red")}`

<!-- # SK2 Review -->
`r if(is.character(params$data21)){knitr::asis_output("# **SK2 Review**")}`

`r if(is.character(params$data21)){htmltools::a("Skin Assessment",href = "//oneabbott.com/dept/ADC/Technical_OPS/Clinical_Affairs/Clinical Study Files/Sensor Systems/ADC-US-RES-16157_InHouse Sensor/CDM/Database/CRF Load Files/aCRFS/ADC-US-RES-16157_SkinAssess_RevA.pdf")}`

```{r Load sk2, eval = is.character(params$data21)}
# sk2 <- read_sas(gsub("\\\\", "/", r"(\\wf00168p.oneabbott.com\data1\CDM\ADC-US-RES-16157_InHouse Sensor\OpenClinicaExtract\Current\115\sk2.sas7bdat)"))
sk2 <- read_sas(params$data21)
sk2 <- sk2 %>%
       mutate(Subject = as.character(Subject)) %>%
       arrange(Subject)
```

```{r sk2, eval = is.character(params$data21)}
htmltools::browsable(
   tagList(
    tags$button(
      tagList(fontawesome::fa("download"), "Download as CSV"),
      onclick = "Reactable.downloadDataCSV('sk2', 'sk2.csv')"
    ),
sk2[
# Assessment Site
!str_detect(sk2$PELOC,regex("LA|RA",ignore_case = T)) | 
# General skin tone score
!str_detect(sk2$PEORRES1,regex("1=Poor|2=Average|3=Good",ignore_case = T)) | 
# Cellulite score
!str_detect(sk2$PEORRES2,regex("1=Significant|2=Average|3=Minor",ignore_case = T)) |
# Fine Lines Wrinkles score
!str_detect(sk2$PEORRES3,regex("1=Significant|2=Average|3=Minor",ignore_case = T)) |
# Hair Coverage score
!str_detect(sk2$PEORRES4,regex("1=Significant\\(shaving required\\)|2=Non-significant",ignore_case = T)) |
# Dry Skin score
!str_detect(sk2$PEORRES5,regex("1=Significant\\(Flaky\\)|2=Non-significant",ignore_case = T)) |
# Scabbing score
!str_detect(sk2$PEORRES6,regex("Yes|No",ignore_case = T)) | 
# If Scabbing score is Yes
str_detect(sk2$PEORRES6,regex("Yes",ignore_case = T)) & str_detect(sk2$PEORRES7,"^$|pattern") |
# Scarring score
!str_detect(sk2$PEORRES8,regex("Yes|No",ignore_case = T)) | 
# If Scarring score is Yes
str_detect(sk2$PEORRES8,regex("Yes",ignore_case = T)) & str_detect(sk2$PEORRES9,"^$|pattern") | 
# Hypo/Hyperpigmentation score
!str_detect(sk2$PEORES10,regex("Yes|No",ignore_case = T)) | 
# If Hypo/Hyperpigmentation score is Yes
str_detect(sk2$PEORES10,regex("Yes",ignore_case = T)) & str_detect(sk2$PEORES11,"^$|pattern")
  ,][,-c(1,3,5:13)] %>%
  {if (params$label) (sjlabelled::label_to_colnames(.)) else .} %>%
  reactable(paginationType = "jump", striped = TRUE, highlight = TRUE, searchable = TRUE, filterable = TRUE, defaultPageSize = 6, resizable = TRUE,elementId = "sk2",height = 600,
     defaultColDef = colDef(align = "center",minWidth = 115),
     columns = list(Subject = colDef(sticky = "left"))
     )
  )
)
```

`r if(is.character(params$data21) && is_empty(sk2$Subject)){knitr::asis_output("SK2 is empty")}`

`r if(is.character(params$data21)){knitr::asis_output("1. PELOC(Assessment Site) should be either RA or LA")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PELOC,regex("LA|RA",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("2. PEORRES1(General skin tone score) should be 1=Poor, 2=Average, abd 3=Good")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORRES1,regex("1=Poor|2=Average|3=Good",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("3. PEORRES2(Cellulite score) should be 1=Significant, 2=Average, abd 3=Minor")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORRES2,regex("1=Significant|2=Average|3=Minor",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("4. PEORRES3(Fine Lines Wrinkles score) should be 1=Significant, 2=Average, abd 3=Minor")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORRES3,regex("1=Significant|2=Average|3=Minor",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("5. PEORRES4(Hair Coverage score) should be either 1=Significant(shaving required) or 2=Non-significant")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORRES4,regex("1=Significant\\(shaving required\\)|2=Non-significant",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("6. PEORRES5(Dry Skin score) should be either 1=Significant(Flaky) or 2=Non-significant")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORRES5,regex("1=Significant\\(Flaky\\)|2=Non-significant",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("7. PEORRES6(Scabbing score) should be either Yes or No")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORRES6,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("8. If PEORRES6(Scabbing score) is Yes, PEORRES7(Scabbing Area (cm2)) should not be blank")}` `r if(is.character(params$data21)){colorize(sk2[str_detect(sk2$PEORRES6,regex("Yes",ignore_case = T)) & str_detect(sk2$PEORRES7,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("9. PEORRES8(Scarring score) should be either Yes or No")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORRES8,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("10. If PEORRES8(Scarring score) is Yes, PEORRES9(Scarring Area (cm2)) should not be blank")}` `r if(is.character(params$data21)){colorize(sk2[str_detect(sk2$PEORRES8,regex("Yes",ignore_case = T)) & str_detect(sk2$PEORRES9,"^$|pattern"),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("11. PEORES10(Hypo/Hyperpigmentation score) should be either Yes or No")}` `r if(is.character(params$data21)){colorize(sk2[!str_detect(sk2$PEORES10,regex("Yes|No",ignore_case = T)),]$Subject,"red")}`

`r if(is.character(params$data21)){knitr::asis_output("12. If PEORES10(Hypo/Hyperpigmentation score) is Yes, PEORES11(Hypo/Hyperpigmentation Area (cm2)) should not be blank")}` `r if(is.character(params$data21)){colorize(sk2[str_detect(sk2$PEORES10,regex("Yes",ignore_case = T)) & str_detect(sk2$PEORES11,"^$|pattern"),]$Subject,"red")}`
